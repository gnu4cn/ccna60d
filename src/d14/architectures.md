# 无线架构


部署无线网络有三种架构方法：

- 自主（自治）架构
- 基于云的架构
- 分离式 MAC 架构

## 自主（自治）架构

这种架构使用一个处理了允许无线客户端连接到无线网络所需的所有功能的独立接入点。由于这些自治接入点是单独配置的，因此诸如 VLAN 标签、信道和其他无线电配置等参数，都必须在所有自主接入点中单独复制。

![自主架构](../images/autonomous_arch.png)

**图 14.32** -- **自主架构**

以下步骤描述了某个自主 AP 下如何通信：

1. 客户端以可用的 SSID 与该 AP 关联；
2. 该 SSID 被映射到某个特定 VLAN；
3. 接入点在将数据发送到以中继模式运行的交换机接口前，会将其以映射的 VLAN 打上标签；
4. 交换机将流量转发到目的地。

## 基于云的架构

这种架构允许所有接入点从位于云上的某个单一管理界面管理，所谓云基本上是某种部署在厂商处所的平台。思科的 Meraki 解决方案，就是基于云架构的一个很好的示例。其简化了接入点的管理与初始配置，因为他们会自动与云联系，并根据指定设置加载配置。Meraki 并为在 CCNA 考试大纲中涉及。

云界面的功能包括：

- 配置与管理接入点
- 监控无线网络性能
- 生成无线报告
- 执行流量分析与七层可见性
- 维护接入点与客户端的列表
- 在地图和（建筑）平面图上可视化接入点
- 执行接入点的 SNMP 与 Syslog 轮询


![基于云的架构](../images/cloud_arch.png)

**图 14.33** -- **基于云的架构**

## 分离式 MAC 架构

这种架构由一个轻量级接入点，及一个无线 LAN 控制器组成。这种架构允许在轻量级接入点和无线 LAN 控制器之间，分离 802.11 的那些功能。

无线设备由两项功能组成 -- 实时功能与管理功能。在这种结构下，实时功能由接入点负责，而无线 LAN 控制器负责管理功能。


**图 14.34** -- **实时功能与管理功能**

协议的实时要求，由接入点处理，包括以下项目：

- 无线客户端与接入点之间的数据帧交换
- 信标（802.11 的数据帧）转换（注：802.11 信标转换是指 Wi-Fi 设备（站/客户端）如何在不同的接入点（AP）之间移动。）
- 发送信号质量信息到无线 LAN 控制器
- 监控无线电信道和其他接入点的存在
- 802.11 数据帧的加密与解密

协议的管理功能，由 WLC 处理，包括以下项目：

- 安全（PSK、EAP 等）
- 关联和重关联
- 客户端 IP 地址
- 二层与三层漫游
- QoS
- 无线电管理
- 到比如 802.3（有线 LAN）等网络的转换与桥接
- 接入点的配置管理
- 接入点的（固件）镜像管理


无线接入点的控制和配置（CAPWABP），是用于管理接入点的行业标准协议。CAPWAP 推动接入点发现与加入过程、接入点的配置、接入点软件推送与无线安全等。

在接入点可广播某个 SSID 供无线客户端加入该无线网络前，接入点首先需要发现并加入 WLC，并从 WLC 下载配置。

以下步骤描述了 WLC 的发现与连接过程：

1. 接入点发现 WLC；
2. CAPWAP 隧道在 WLC 和接入点之间形成。CAPWAP 隧道将 UDP 端口 5246 用于控制平面，将 UDP 端口 5247 用于数据平面；
3. 接入点加入该 WLC；
4. 接入点从该 WLC 下载软件及配置。

![CAPWAP 的传输](../images/capwap.png)

**图 14.35** -- **CAPWAP 的传输**

一旦配置被推送到接入点，那么该接入点就会广播可用的 SSID，允许无线客户端加入。

![CAPWAP 的架构](../images/capwap_arch.png)


**图 14.36** -- **CAPWAP 架构**

以下步骤描述了轻量级接入点下的通信方式：

1. 接入点发现并加入 WLC;
2. 一条 CAPWAP 隧道在接入点和 WLC 之间创建出来；
3. 接入点从 WLC 获取配置，并广播可用的 SSID；
4. 无线客户端以该 SSID 关联到该接入点；
5. 接入点经由管理 VLAN，将标有该 SSID 的客户端数据，通过 CAPWAP 隧道发送到 WLC；
6. WLC 接收到流量后，将其发送回与客户端的 SSID 相对应 VLAN 中的交换机中继端口；
7. 交换机将流量转发到目的地。

一旦自某个 WLC 到一个或多个轻量级 AP 的 CAPWAP 隧道建立后，WLC 就可以开始提供各项额外功能，包括以下这些：

- 动态信道分配 -- WLC 可根据区域内的其他活动接入点，自动选择和配置由各个 LAP 使用的射频信道；
- 发射功率优化 -- WLC 可根据所需的覆盖区域，自动设置各个 LAP 的发射功率；
- 自愈式无线覆盖 -- 当某个 LAP 的无线电死机时，该覆盖空洞可通过自动调高周围 LAP 的发射功率 “治愈”；
- 灵活的客户端漫游 -- 客户端可在 LAP 之间，以时间非常短的漫游时间，漫游于二层或三层；
- 动态的客户端负载均衡 -- 当两个或多个 LAP 被布置为覆盖同一地理区域时，WLC 可将客户端与使用最少的 LAP 关联。这就将客户端负载，分布到多个 LAP 了；
- 射频的监控 -- WLC 会管理每个 LAP，并扫描信道监控射频使用情况。通过监听某个信道，WLC 可远程收集有关 RF 干扰、噪音、相邻 LAP 的信号，以及来恶意 AP 或自组织客户端发出的信号等信息；
- 安全管理 -- 在允许客户端关联及访问该 WLAN 前，WLC 可根据某种中心服务认证客户端，并可要求无线客户端从某个受信任的 DHCP 服务器获取 IP 地址；
- 无线入侵保护系统 -- 利用其中心位置，WLC 可监控客户端数据，检测并防止恶意活动。


## 接入点模式

根据咱们的各项要求，轻量级接入点可被配置为以不同专门模式运行。Cisco 的接入点支持 8 种模式：

- 本地
- 监视器
- FlexConnect
- 嗅探器
- 流氓探测器
- 网桥
- Flex + 网桥
- SE-connect

### 本地模式

这是轻量级 AP 的默认模式。AP 会建立到 WLC 的隧道，并将所有客户端流量传输到 WLC。只有当 WLC 可达时，AP 才能在这一模式下运行，因此通常在这一模式下，WLC 和 AP 会同时位于一处物理位置。

![接入点的本地模式](../images/ap_local_mode.png)


**图 14.37** -- **AP 的本地模式**

### 监视器模式

在这一模式下，AP 完全不会传输（流量）。相反，他会作为一个专门的传感器运行，用于：

- 检测入侵检测系统 (IDS) 的事件；
- 检测恶意 AP；
- 利用一些基于位置的服务，确定无线站的位置。

![监视器模式下的 AP](../images/monitor_mode.png)

**图 14.38** -- **监视器模式下的 AP**

### FlexConnect 模式

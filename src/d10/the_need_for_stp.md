# STP 的必要性

STP 定义在 IEEE 802.1D 标准中。其唯一目的，是通过关闭可能导致环路的端口，防止咱们局域网中的环路。为了保持一个无环路的逻辑拓扑，交换机会每两秒传递一次网桥协议数据单元（BPDU）。BPDU 是一些生成树拓扑中，用于传递有关端口、地址、优先级及开销等信息的数据报文。BPDU 被以 VLAN ID 打了标签。

下图 10.1 显示了环路怎样会怎样在网络中创建出来。由于每台交换机都会学习到 `VLAN 20`，其也会通告其他交换机，他可到达 `VLAN 20`。很快，每台交换机都会认为，其是 `VLAN 20` 流量的源，从而环路即被造成。因此，任何目的地为 `VLAN 20` 的数据帧，都会在交换机之间传递。

![循环是怎么建立的](../images/3101.png)

**图 10.1** -- **环路如何被创建出来**


STP 运行着一种决定哪些交换机端口对某个特定 VLAN 保持开放（活动），哪些端口需要对该特定 VLAN 关闭的算法。这意味着某个端口可为一个 VLAN 积极转发流量，却为另一 VLAN 关闭。

生成树域中的所有交换机，均使用 BPDU 通信及交换报文。STP 使用 BPDU 的交换，确定出由以下三个变量决定的网络拓扑：

- 与每个交换机关联的唯一 MAC 地址（交换机标识符）
- 与每个交换机端口关联的到根桥路径开销值
- 与每个交换机端口关联的端口标识符（端口的 MAC 地址）


BPDU 被每两秒发送，这允许快速的网络环路检测与拓扑信息交换。BPDU 的两种类型分别是：配置的 BPDU 和拓扑变化通知的 BPDU；只有配置 BPDU 将在此介绍。

> *知识点*：
>
> - switch identifier
>
> - the path cost
>
> - the Root Bridge
>
> - the port identifier
>
> - Configuration BPDU
>
> - Topology Change Notification BPDU



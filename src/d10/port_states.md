# 生成树的端口状态

生成树算法 (STA) 定义了某个 STP 控制下的端口，在进入活动转发状态前，将经历的数种状态。802.1D 的端口状态如下：

- 阻塞 -- 仅有 BPDU 被接收（20 秒）
- 侦听 -- BPDU 被发送和接收（15 秒）
- 学习 -- 桥接数据表建立（15 秒）
- 转发 -- 发送/接收数据
- 禁用 -- 管理性停机


某个端口会以下方式，游离于这些状态：

1. 从初始化到阻塞；
2. 从阻塞到监听或禁用；
3. 从监听到学习或禁用；
4. 从学习到转发或禁用；
5. 从转发到禁用。

一些 STP 的定时器，会该过程中用于控制收敛：

- `Hello` -- 2 秒（每个配置 BPDU 之间的时间）
- `Forward Delay` -- 15 秒（控制监听/学习状态的持续时间）
- `Max Age` -- 20 秒（控制阻塞状态的持续时间）

默认的收敛时间为 30 至 50 秒。

> *知识点*：
>
> - the Spanning Tree Algorithm, STA
>
> - administratively down
>
> - the Initialization state
>
> - the Blocking state
>
> - the Listening state
>
> - the Disabled state
>
> - the Forwarding state

## 生成树阻塞状态

处于阻塞状态的交换机端口，会执行以下操作：

- 丢弃在端口上接收自连接网段的数据帧；
- 丢弃交换自另一端口的数据帧；
- 不会将站点位置，纳入其地址数据库；
- 接收 BPDU，并将其导向系统模组；
- 不会传送接收自系统模组的 BPDU；
- 接收并响应网络管理报文。


## 生成树监听状态

监听状态是端口在阻塞状态之后，进入的第一个过渡性状态。当 STP 确定了该端口应参与数据帧转发时，该端口就会进入这种状态。处于监听状态的某个交换机端口，会执行以下操作：

- 丢弃在端口上接收自连接网段的数据帧；
- 丢弃交换自另一端口的数据帧；
- 不将站点位置纳入其地址数据库；
- 接收 BPDU 并将其导向系统模组；
- 接收、处理及传输接收自系统模组的 BPDU；
- 接收并响应网络管理报文。

## 生成树学习状态

学习状态是端口进入的第二种过渡状态。该状态在监听状态后，端口进入转发状态前。在此状态下，端口会学习 MAC 地址，并将他们安装到转发表。处于学习状态的交换机端口，会执行以下操作：

- 丢弃接收自连接网段的数据帧；
- 丢弃交换自另一端口的数据帧；
- 将站点位置纳入（安装）到其地址数据库中；
- 接收 BPDU 并将导向至系统模组；
- 接收、处理及传输接收自系统模组的 BPDU；
- 接收并响应网络管理报文。

## 生成树转发状态


转发状态是端口在学习状态后，进入的最终过渡状态。处于转发状态的端口会转发数据帧。处于转发状态的交换机端口会执行以下操作：

- 转发接收自连接网段的数据帧；
- 转发转发自另一端口的数据帧；
- 将站点位置信息纳入（安装）到其地址数据库；
- 接收 BPDU 并将其导向系统模组；
- 处理接收自系统模组的 BPDU；
- 接收并响应网络管理报文。

## 生成树禁用状态

禁用状态不是端口正常 STP 进程的一部分。相反，由网络管理员管理性关闭，或由系统因某种故障条件关闭的某个端口，均被视为处于禁用状态。被禁用的端口会执行以下操作：

- 丢弃接收自连接网段的数据帧；
- 丢弃交换自另一端口的数据帧；
- 不会将站点位置纳入地址数据库；
- 接收 BPDU，但不会将其导向系统模组；
- 不会接收来自系统模组的 BPDU；
- 接收并响应网络管理报文。



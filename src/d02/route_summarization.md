# 路由汇总

互联网上有数以百万计的路由。若所有这些路由都要单独存储，那么互联网在很多年前就已经停滞不前了。路由汇总，也称超网，是在 [RFC 1338](https://datatracker.ietf.org/doc/html/rfc1338) 中提出的。


当咱们打算阅读非常全面的路由汇总指南时，那么要抓紧时间阅读 Jeff Doyle 出色的思科书籍 *Routing TCP/IP Volume 1*，该书现已是第二版了。

> *知识点*：
>
> - supernetting


## 邮政编码

邮政编码被美国邮政局，用来改进信件路由，以在美国境内投送（见图 2.6）。第一位数字表示一组美国的州份，第二和第三位数字表示该组州份内的某个地区。这个主意在于，信件和包裹可很快经由机器或人工，路由到正确的州份，然后转发到该州。当邮件到达该州后，其可被转发到正确的地区。从那里再被路由到正确的城市，依此类推，直到其被分类装入正确的邮袋，交给当地的邮政投递员。


![美国邮政编码](../images/0502.png)

**图 2.6** -- **美国的邮政编码**

邮政编码系统被设计出来，是为使邮件的路由安排更加准确和高效。例如，亚特兰大的分拣处，不需要知道包裹要寄往旧金山的哪条街道。当必须要存储该信息时，就会让分拣过程将无法进行。


## 路由汇总前提条件

为了在咱们的网络中使用路由汇总，咱们就需要使用某种诸如 RIPv2、EIGRP 或 OSPF 的无类协议（稍后会介绍）。咱们还需以一种分层顺序，设计咱们网络，这将要求仔细的规划和设计。这意味着咱们不能随意地将网络，分配给咱们网络内不同的路由器或局域网。


## 应用路由汇总


我们移步至一个网络示例，看看当咱们不使用路由汇总时，咱们网络上的问题将如何。在这个示例中，便是路由汇总在网络上某个 IP 地址范围下，将如何发挥作用。下图 2.7 中的路由器，连接了多个网络。第一种选择是将全部这些网络，通告给下一条路由器。另一种方法是，将这八个网络汇总减少为一条路由，并将这条汇总发送给下一跳路由器，这将减少带宽、CPU 及内存等的需求。


![路由汇总的一个实例](../images/0503.png)

**图 2.7** -- **路由汇总的一个实例**

计算汇总路由的唯一方法，是将 IP 地址转换成二进制（抱歉）。当咱们没有完成这点时，纳闷咱们将无法知道，自己是否在通告正确的汇总路由，这将导致咱们网络上的故障。

首先，要完整写出全部的网络地址，然后是其右侧的二进制版本，如下所示：


| 网络号 | 二进制形式 |
| -- | -- |
| `172.16.8.0` | `10101100.00010000.00001</u>`000.00000000` |
| `172.16.9.0` | `10101100.00010000.00001</u>`001.00000000` |
| `172.16.10.0` | `10101100.00010000.00001</u>`010.00000000` |
| `172.16.11.0` | `10101100.00010000.00001</u>`011.00000000` |
| `172.16.12.0` | `10101100.00010000.00001</u>`100.00000000` |
| `172.16.13.0` | `10101100.00010000.00001</u>`101.00000000` |
| `172.16.14.0` | `10101100.00010000.00001</u>`110.00000000` |
| `172.16.15.0` | `10101100.00010000.00001</u>`111.00000000` |
| 匹配位 | `10101100.0010000.00001` = `21`位 |

我（作者）已用斜体和下划线，标出了每个地址中的匹配位。咱们可以看到，每个地址中的前 21 位匹配了，因此咱们的汇总路由，可反映下面的 21 位：


`172.16.8.0 255.255.255.248.0`

使用路由汇总的另一显著优势，是当咱们路由器上的某个本地网络宕机时，汇总网络仍将被向外通告。这意味着该网络的其余部分，将不需要更新其路由表，或这更糟糕的是，将不必处理某条抖动路由（快速开机与宕机）。我（作者）选择了两个有关路由汇总的练习，供咱们练习。

**练习 1**：请写出下面地址的二进制等值，然后确定哪些位匹配。为节省时间，我（作者）已为咱们写出了前两个八位组。


| 网络号 | 二进制形式 |
| -- | -- |
| `172.16.50.0` | `10101100.00010000.` |
| `172.16.60.0` | `10101100.00010000.` |
| `172.16.70.0` | `10101100.00010000.` |
| `172.16.80.0` | `10101100.00010000.` |
| `172.16.90.0` | `10101100.00010000.` |
| `172.16.100.0` | `10101100.00010000.` |
| `172.16.110.0` | `10101100.00010000.` |
| `172.16.120.0` | `10101100.00010000.` |


咱们要通告的汇总地址是什么？答案在本章最后。


**练习 2** ：下面这家公司有三台连接其总部路由器的路由器。他们需要汇总通告自伦敦 1、2 和 3 的路由。


![通告自伦敦`1`、`2`、`3`号路由器的汇总路由](../images/0504.png)

**图 2.8** -- **通告自 London 1、2 及 3 的汇总路由**

咱们来以 London 1 开始：


| 网络 | 二进制形式 |
| -- | -- |
| `10.1.0.0` | <u>00001010.00000001.00000</u>`000.00000000` |
| `10.1.1.0` | <u>00001010.00000001.00000</u>`001.00000000` |
| `10.1.2.0` | <u>00001010.00000001.00000</u>`010.00000000` |
| `10.1.3.0` | <u>00001010.00000001.00000</u>`011.00000000` |
| `10.1.4.0` | <u>00001010.00000001.00000</u>`100.00000000` |
| `10.1.5.0` | <u>00001010.00000001.00000</u>`101.00000000` |
| `10.1.6.0` | <u>00001010.00000001.00000</u>`110.00000000` |
| `10.1.7.0` | <u>00001010.00000001.00000</u>`111.00000000` |

而对于 London 2：

| 网络 | 二进制形式 |
| -- | -- |
| `10.1.8.0` | <u>00001010.00000001.00001</u>`000.00000000` |
| `10.1.9.0` | <u>00001010.00000001.00001</u>`001.00000000` |
| `10.1.10.0` | <u>00001010.00000001.00001</u>`010.00000000` |
| `10.1.11.0` | <u>00001010.00000001.00001</u>`011.00000000` |
| `10.1.12.0` | <u>00001010.00000001.00001</u>`100.00000000` |
| `10.1.13.0` | <u>00001010.00000001.00001</u>`101.00000000` |
| `10.1.14.0` | <u>00001010.00000001.00001</u>`110.00000000` |
| `10.1.15.0` | <u>00001010.00000001.00001</u>`111.00000000` |


同时对于 London 3：


| 网络 | 二进制形式 |
| -- | -- |
| `10.1.16.0` | <u>00001010.00000001.00010</u>`000` |
| `10.1.17.0` | <u>00001010.00000001.00010</u>`001` |
| `10.1.18.0` | <u>00001010.00000001.00010</u>`010` |
| `10.1.19.0` | <u>00001010.00000001.00010</u>`011` |
| `10.1.20.0` | <u>00001010.00000001.00010</u>`100` |
| `10.1.21.0` | <u>00001010.00000001.00010</u>`101` |
| `10.1.22.0` | <u>00001010.00000001.00010</u>`110` |
| `10.1.23.0` | <u>00001010.00000001.00010</u>`111` |

咱们将需要掌握 CCNA 考试的路由汇总。当咱们可快速求得那些共用的二进制位时，那么咱们便应能够快速且准确地回答这些问题。





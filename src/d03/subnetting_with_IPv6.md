# IPv6 下的子网划分

正如咱们已经了解的，IPv6 地址是以某个前缀，分配给公司的。地址的主机部分，总是 64 位，而标准前缀通常是 48 位或 `/48`。这留下了 16 位给网络管理员，用于子网划分。

就网络分址而言，由于同样的一些规则都应用到 IPv4 与 IPv6，对每个网段咱们只能有一个网络。咱们不能破坏地址，而在网络的一个部分使用某些主机位，并在另一部分使用另一些主机位。

当咱们看看下图中的分址，那么情况就会更加明了。


| 全球路由前缀 | 子网 ID | 接口 ID |
| :-: | :-: | :-: |
| 48 位或 `/48` | 16 位（65535 个可行子网） | 64 位 |

咱们永远无需担心每个子网的主机位会用完，因为每个子网都有超过 18500 亿个主机。任何组织都不可能用完子网，但即使出现这种情况，另一个全球路由前缀也可由 ISP 轻易提供。

比方说，咱们被分配了全球路由前缀 `0:123:abc/48`。这个地址占用了一个完整 IPv6 地址的三部分，每个部分，或者四元组都是 16 位，因此目前咱们已使用了 48 位。主机部分将需要 64 位，那么留给咱们 16 比特用作子网的分配。


咱们只需以十六进制从零开始往上数（零是合法的），然后一直数下去。对于咱们的主机，咱们也可以这样做，除非咱们打算为网段上的服务器，保留前几个地址。

让我（作者）用个更简单的前缀来举例 -- `2001:123:abc/48`。第一个子网将为全 `0`，当然，每个子网的第一个主机也将为全 `0`，这是合法的（因为在 IPv6 下咱们不会保留全 `0` 及全 `1` 的地址）。咱们可使用缩写格式 `::` 表示这些全 `0` 的主机。以下是前几个子网和主机地址。


| 全球前缀 | 子网 | 第一个地址 |
| :-: | :-: | :-: |
| `2001:123:abc` | `0000` | `::` |
| `2001:123:abc` | `0001` | `::` |
| `2001:123:abc` | `0002` | `::` |
| `2001:123:abc` | `0003` | `::` |
| `2001:123:abc` | `0004` | `::` |
| `2001:123:abc` | `0005` | `::` |
| `2001:123:abc` | `0006` | `::` |
| `2001:123:abc` | `0007` | `::` |
| `2001:123:abc` | `0008` | `::` |
| `2001:123:abc` | `0009` | `::` |
| `2001:123:abc` | `000A` | `::` |
| `2001:123:abc` | `000B` | `::` |
| `2001:123:abc` | `000C` | `::` |
| `2001:123:abc` | `000D` | `::` |
| `2001:123:abc` | `000E` | `::` |
| `2001:123:abc` | `000F` | `::` |
| `2001:123:abc` | `0010` | `::` |
| `2001:123:abc` | `0011` | `::` |
| `2001:123:abc` | `0012` | `::` |
| `2001:123:abc` | `0013` | `::` |
| `2001:123:abc` | `0014` | `::` |
| `2001:123:abc` | `0015` | `::` |
| `2001:123:abc` | `0016` | `::` |
| `2001:123:abc` | `0017` | `::` |


我（作者）相信咱们已注意到与 IPv4 分址规则的一处不同，那就是咱们可以使用全零的子网，且第一个子网地址总是全零。看看一个简单的网络拓扑结构，咱们可按以下方式分配这些子网。

![IPv6子网分配](../images/0720.png)

**图 3.20** -- **分配 IPv6 子网**

真的这么简单吗？当咱们回顾 [IPv4 子网划分](../d02/subnetting.md) 小节时，要弄清楚这点，以及计算出有多少主机和子网，还有记住要排除某些地址等等，就可能会成为一场噩梦。IPv6 的子网划分要简单得多。咱们可不会分配到某个 48 位前缀，对于家庭网络其可能是 `/56` 或更小，但原理是一样的。

咱们也可在位边界外建立子网，但这将是非常不寻常的，同时思科要咱们在考试的短时间内了解这么多细节，也是不公平的。希望考试不会刻意捉弄咱们，但世事难料。以防万一，下面是个 `/56` 前缀长度地址的示例：

`2001:123:abc:8bbc:1221:cc32:8bcc:4231/56`

这个前缀为 56 位，转换为 14 个十六进制数（14 x 4 = 56），因此咱们知道，这个前缀会将咱们带到某个四元组的中间。这便是考试中，咱们可能出错的地方。咱们必须将前缀中断前的那个四元组中的第 3 和第 4 个十六进制位清零：

<code>
2001:123:abc:<u>8b00</u>:0000:0000:0000:0000/56
</code>

我（作者）已将位边界断开处的四元组加了下划线。在考试中时间仓促和压力下，咱们很可能会错过这重要一步。请记住，咱们还可以将这个地址（第一个子网的第一台主机），缩写为：


<code>
2001:123:abc:<u>8b00</u>::/56
</code>

若他们真的想在考试中抓住咱们的把柄，那很可能是想让咱们，消掉在位边界端开前的四元组后面的零：

<code>
2001:123:abc:<u>8b</u>::/56
</code>


上面的缩写是非法的。

咱们可以借用主机部分的位用于子网，但绝对没有理由这样做，而且这样做会破坏运用 IPv6 被发明就要用到的许多特性的能力，包括无状态的自动配置。



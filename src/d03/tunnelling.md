# 在 IPv4 网络上隧道传输 IPv6 的数据报

所谓隧道技术，是整合 IPv6 与 IPv4 网络的第二种方式，涉及封装 IPv6 的数据包或数据报，并通过 IPv4 网络发送他们。为了支持将在这一小节中讲到的不同隧道机制，思科 10S 的边缘路由器，必须有着某种允许 IPv6 数据包得以封装在 IPv4 数据包中，并随后在终止路由器处得以解封装的双栈部署。应指出的是，那些中间路由器无需运行 IPv6。换言之，这些路由器将只是些仅支持 IPv4 的路由器。下图 3.20 演示了一种典型的隧道部署：


![经由 IPv4 网络进行 IPv6 数据包的隧道传输](../images/0801.png)

**图 3.20** -- **在 IPv4 网络上隧道传输 IPv6 的数据包**

参照图 3.20，假定 IPv6 的 `Host 1` 正发送数据报到 IPv6 的 `Host 2`，那么以下的事件序列，便会在这些数据包通过网络时发生：

1. IPv6 的 `Host 1` 发送以 IPv6 的 `Host 2` 为目的地的数据包到其默认网关，及路由器 `R4`。这些数据包均是原生的 IPv6 数据包，在头部中带有 IPv6 的源地址和目的地址；
2. 路由器 `R4` 是个双栈路由器。其 LAN 接口已启用了 IPv6，而其 WAN 接口已启用了 IPv4。`R4` 已在其 WAN 接口和同样是个双栈路由器的 `R1` 的 WAN 接口间，配置了个隧道。`R4` 接收了 IPv6 的数据包后，就会将这些 IPv6 数据包，封装在 IPv4 的数据包中，并转发他们到 `R2`。这些数据包的目的地址，会被设置为 `R1`，同时路由器 `R3` 会将 IPv4 头部的值设为 41，表明在 IPv4 数据包中 IPv6 数据包的封装；
3. `R2` 会收到这些 IPv4 数据包，并会使用 IPv4 头部中所指定的目的地址，简单地向这些数据的最终目的地，路由或转发这些数据包；
4. `R3` 会收到这些来自 R2 的 IPv4 数据包，并使用于 IPv4 头部中指定的目的地址，简单地向这些数据包的最终目的地转发他们；
5. `R1`，作为隧道终止路由器与出口点，会收到这些原生的 IPv4 数据包，并解封装他们，从而仅留下 IPv6 的数据报。该路由器随后就会转发这些 IPv6 数据包到 `Host 2`。

这一封装与解封装过程对两个主机，以及两个隧道端点之间的那些中间路由器，都是透明的。有数种方式可用于在 IPv4 数据包中隧道传输 IPv6 的数据包（见下文）。我们将不在这本指南中深入探讨任何配置细节，因为这超出了 CCNA 考试要求。

别的一些隧道传输方式包括在下面。思科可能希望咱们知道他们存在，但咱们应不会被问及任何有关他们工作原理的问题。

- 静态的（手动配置的）IPv6 隧道
- 6to4 的隧道
- 自动的 IPv4 兼容隧道
- ISATAP 的隧道
- 通用的路由封装隧道



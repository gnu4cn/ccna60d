# OSI 和 TCP 模型


## OSI 模型


开放标准互连（OSI）由国际标准化组织（ISO）创建。随着 20 世纪 80 年代技术的蓬勃发展，网络设备和软件领域的几大巨头纷纷崛起，其中包括思科、微软、Novell、IBM、惠普、苹果以及别的一些公司。每家场上都有他们自己的电缆和端口类型，并运行他们自己的通信协议。当咱们想从一家公司购买路由器，从另一家公司购买交换机，再从别的另一家公司购买服务器时，这就会造成很大问题。

这些问题也有一些变通办法，比如在网络上部署可在协议间转换的网关，但此类解决方案会造成瓶颈（即网络的慢速部分），并使故障排除非常困难和耗时。最终，这些厂商不得不同意一种适用于所有人的通用标准，而这套成为传输控制协议/互联网协议（TCP/IP）的免费协议，最终为大多数厂商采用。最后，那些没有采用 TCP/IP 协议的厂商，便失去了市场份额，纷纷倒闭。


国际标准化组织创建了帮助厂商就一套通用标准达成一致，从而使他们都能工作的 OSI 模型。这个模型涉及到将网络功能，划分为一系列逻辑层次或分层。每层都将执行一组特定功能，例如，当咱们的公司打算专注于网络防火墙时，那么他们将与其他厂商的设备一起使用。

这样做的好处是，每种设备都被设计来很好地执行某种特定角色，而不是不适当地执行数种角色。客户可为他们自己的方案，选择最佳设备，而不会捆绑到某一家厂商。由于某些错误可追溯到某个特定的 OSI 层，因此故障排除变得更加容易。

OSI 模型将所有网络功能，分为七个不同的层。这种分层模型从第 7 层开始，一直往下到第 1 层。如下表 1.2 所示，离用户较近的较复杂功能位于顶部，向下延伸至底层的网络电缆规格。

> *知识点*：
>
> - Open Standards Interconnection, OSI
>
> - International Organization for Standardization, ISO


**表 1.2** -- **OSI 模型**

| 层编号 | 分层名字 |
| :-: | :-: |
| 7 | 应用 |
| 6 | 表示 |
| 5 | 会话 |
| 4 | 传输 |
| 3 | 网络 |
| 2 | 数据链路 |
| 1 | 物理 |

咱们可以 “**A**ll **P**eople **S**eem **T**o **N**eed **D**ata **P**rocessing” 口诀，轻松记住这些分层的名字。我（作者）当然会习惯于用数字来表示各层，因为这是现实世界中网络技术人员使用 OSI 的方式。

当数据从顶层向下传递到底层，以便在物理的网络介质上传输时，数据会被放置进入不同类型的逻辑数据匣。虽然我们通常称这些数据匣为 “数据包”，但根据 OSI 的分层，他们有着不同名字。数据在 OSI 模型中向下移动的过程，称为封装（见图 1.29）。数据再往回向上移动时，将这些匣子从数据上剥离，就叫做解封装。


!["封装"](../images/60days-23.png)

**图 1.29** -- **封装**


对于 CCNA 考试，咱们将要求掌握 OSI 模型，以及哪些应用和协议，适合哪一层。咱们可能还必须使用 OSI 的分层方法，应用咱们的故障排除知识。我们来从第 7 层开始，检视 OSI 的每层。

### 第 7 层--应用层

这一层是最接近最终用户，也就是你和我的层。应用层并非设备的操作系统，但通常提供了诸如电子邮件（SNMP 与 POP3）、web 浏览（使用 HTTP）、及文件传输服务（使用 FTP）等。应用层决定了资源的可用性。


### 第 6 层--表示层

表示层将数据呈现给应用层。多媒体技术就工作于此，因此请考虑 MP4、JPEG、GIF 等。加密、解密和数据压缩，也发生于这层。

### 第 5 层--会话层

会话层的作用，是建立、管理及终止设备间的会话或对话。这些操作发生于逻辑链路上，而真正发生的，是两个软件应用的连接。SQL、RPC 及 NFS 等，全都工作于会话层。

### 第 4 层--传输层

传输层的作用是将来自那些高层的数据，分解成称为段（在这层）的一些更小部分。在设备可通信前，虚电路要在这里建立起来。

在数据可透过网络传递前，传输层需要确定多少数据可被发送到远端设备。这取决于端到端链路的速率和可靠性。当咱们有着一条高速链路，而终端用户却有着低速链路时，那么数据将需要以较小的块发送。


用于控制数据流的三种方法如下：

- 流量控制
- 窗口化
- 通告/确认


*流量控制*

当接收系统被发送了多于其可处理的信息时，他将请求发送系统短时停止。这种情况通常发生于一侧使用宽带，而另一侧使用拨号调制解调器时。告诉别的设备停止的数据包，称为源抑制消息。


!["流控"](../images/60days-24.png)

**图 1.30** -- **流量控制**


> *知识点*：
>
> - flow control
>
> - windowing
>
> - acknowledgements
>
> - a source quench message


*窗口化*


在窗口化下，两个系统会就在确认被要求前，发送多少数据达成一致。随着数据的移动，这个 “窗口” 会打开及关闭，以保持一种恒定流量。


!["窗口机制"](../images/60days-25.png)

**图 1.31** -- **窗口化**



*通告/确认*


在接收到一定数量的数据段时，他们已安全且以正确顺序到达的事实，就需要通报给发送系统。


!["通告机制"](../images/60days-26.png)

**图 1.32** -- **通告机制**


所有这些都是在一个称为三次握手的过程中，达成一致的（见图 1.33）。其中咱们会发送一个数据包建立会话。这第一个数据包，称为同步 (SYN) 数据包。然后远端设备会回应一个同步确认（SYN-ACK）数据包。会话在第三阶段一个确认 (ACK) 数据包被发送时建立。所有这些都是经由 TCP 服务完成。


!["三次握手"](../images/60days-27.png)

**图 1.33** -- **三次握手**


> *知识点*：
>
> - a three-way handshake
>
> - a synchronize(SYN) packet
>
> - a synchronize acknowledgement(SYN-ACK) packet
>
> - an acknowledgement(ACK) packet


传输层包括多个协议，而广为人知便是传输控制协议（TCP）和用户数据报协议（UDP），他们是 TCP/IP 协议套件的一部分。这套协议相当有名，因为他是互联网上用到的标准。TCP 被认为是种可靠的面向连接协议。他使用了三次握手、窗口化和别的一些技术，确保数据安全地到达目的地。许多协议都使用了 TCP，包括 Telnet、HTTPS 及 FTP（虽然他位于应用层，但确实使用了 TCP）。

另一方面，UDP 被认为是中无连接协议。他会编号每个数据包，然后将他们发送到他们的目的地。他从不检查这些数据包是否安全到达，也不会在发送数据包前建立连接。有时，数据并不那么重要，应用开发者会决定，当信息未能到达其目的地，其总是可被再次发送。

那为什么要使用 UDP 呢？TCP 会占用网络的大量带宽，甚至在数据被发送前，就有建立连接的大量流量来回发送。这都会占用宝贵时间和网络资源。相比比 TCP 数据包，UDP 数据包会小得多，当真正可靠连接并非那么必要时，他们就非常有用。用到 UDP 的协议包括 TFTP。

### 第三层 -- 网络层


网络层承接了来自传输层的数据段，将其分解成称为数据包的更小单元。大多数网络工程师都将数据称为数据包，无论是在 OSI 的哪一层，这没有问题；但是，请记住，从技术上讲，数据包是网络层的数据包。

网络层必须确定从一个网络到另一网络所采取的最佳路径；出于这一原因，路由器便工作于这层。路由器在此使用逻辑寻址，而 TCP/IP 的寻址被称作 IP 寻址，这将在稍后详细介绍。



### 第 2 层--数据链路层


数据链路层会将数据包，分解成称为帧的更小单元。二层交换机工作于这层，并使用硬件或 MAC 地址，因此他们无需检查 IP 地址和路由表，故可更快地交换流量。一些广域网协议运行在第 2 层，包括 HDLC、ISDN 和 PPP 等，以太网也是如此。


为与其上层和下层对接，数据链路层又被进一步细分为逻辑链路控制（LLC）子层，和介质访问控制（MAC）子层。LLC 子层与网络层对接，而 MAC 子层则与物理层对接。


### 第 1 层--物理层


在这层，数据帧被转换成放置在线路上的比特位。这些比特位由电脉冲组成，分别读作 “开” 和 “关” 位，或二进制的 `1s` 和 `Os`。集线器工作在这一层，同时在这里咱们将发现一些诸如 RJ45 的电缆规格。


## OSI 故障排除


当咱们正排除咱们网络故障时，采用一种分层的方法会非常有效。从这点开始，唯一的决定便是，确定咱们运用 OSI 栈的方式 -- 自下而上、自下而上或分而治方法，即依次着重于网络的各部分。

我（作者）建议一开始使用自下而上的方法，这样当原因往往可在较低的那些分层上找到，例如松动或断裂的电缆或不正确的 IP 寻址时，咱们就不会浪费时间在查看应用上。随着咱们获得了更多经验，采用 “分而治之” 方法将可能更快，具体取决于症状。当咱们于最底层开始，然后逐层向上，咱们将完成如下的一些事情：


**第 1 层** -- 是否所有电缆都被正确插入端口，或者他们是否已松动？电缆末端是否弯曲或磨损？当是电缆问题时，咱们通常将看到设备上琥珀色指示灯显示，而其应是绿色的。是否有人忘记了将正确的速率添加到端口？以太网端口的速率是否被正确设置？接口是否已由网络管理员打开？


**第 2 层** -- 诸如以太网/PPP/HDLC 等的正确协议是否已应用到接口，以使其与另一侧达成一致？


**第 3 层** -- 接口是否正使用正确的 IP 地址及子网掩码？


**第 4 层** -- 是否使用了正确的路由协议，路由器是否正通告着正确的网络？

在咱们完成本书中的那些实验时，咱们就将看到怎样应用这些步骤。一些专家们可能会争论说，有些四层的问题是在三层，有些二层的问题，实际上实在一层层，等等。我（作者）更愿意把着重于我们是在应用一种分层的故障排除方法，而不是争论正确的问题是否在正确的层上。


## TCP/IP，或 DoD 模型


TCP/IP 模型是另一种框架，以及 OSI 模型的一种替代。TCP/IP 模型是一个分四层或五层的模型，由一个叫做 DARPA 的学会创建。他也被称为 DoD 模型。自顶向下的四个分层如下：

| 层 | - | 名字 [应用]|
| :-: | :-: | :-: |
| 4 | - | 应用 [Telnet/FTP/RIP] |
| 3 | - | 传输/主机到主机 [UDP/TCP/ICMP] |
| 2 | - | 互联网/Internetwork [IPSec/IP] |
| 1 | - | 链路/网络接口 [帧中继/以太网/ATM] |


TCP/IP 模型已从四层更新为五层，因此考试中咱们可能会被问及有关分五层 TCP 模型的问题。较上的分层更接近最终用户，二较低的分层则描述了技术或协议如何与其他系统交互。分五层的 TCP 模型如下：

| 层 | - | 名字（应用） |
| :-: | :-: | :-: |
| 5 | - | 应用 [Telnet/FTP/DNS/RIP/HTTP] |
| 4 | - | 传输/主机到主机 [UDP/TCP/ICMP] |
| 3 | - | 网络 [IPSec/IP] |
| 2 | - | 数据链路 [以太网/帧中继/PPP] |
| 1 | - | 链路/网络接口/物理 [线路上的二进制位] |

分五层的 TCP 模型允许更细粒度，其更准确地表示了在数据被投放到线路上前，所发生的实际情况。例如，在二层处数据封装发生了，同时寻址（即数据链路的寻址）也发生了。思科在出考题时似乎更喜欢五层模型。

如下表 1.3 所示，在数据从应用层向下来到物理层时，其会以 OSI 模型中演示的完全一致方式被封装。


**表 1.3** -- **五层的 TCP 模型**


| 层 | 内容 | 单位 |
| :-: | :-: | :-: |
| 应用 | 数据，完全未被封装 |  |
| 传输 | TCP 头部会被添加到数据 | 段 |
| 网络 | IP 头部被加上（包括 IP 地址） | 包 |
| 数路链路 | 数据链路头部被加上（数据链路地址） | 帧 |
| 物理 | 被转换为电信号 | 线路上的二进制位 |


咱们可能会被问及，TCP/IP 模型与 OSI 模型的映射关系。这在下表 1.4 中得以演示。

**表 1.4** -- **TCP/IP 模型到 OSI 模型的映射**

<table>
    <tr>
        <th>层编号</th><th>OSI 分层名字</th><th>TCP/IP（DoD）分层名字</th>
    </tr>
    <tr>
        <td>7</td><td>应用</td><td rowspan="3">应用</td>
    </tr>
    <tr>
        <td>6</td><td>表示</td>
    </tr>
    <tr>
        <td>5</td><td>会话</td>
    </tr>
    <tr>
        <td>4</td><td>传输</td><td>主机到主机</td>
    </tr>
    <tr>
        <td>3</td><td>网络</td><td>网际网络</td>
    </tr>
    <tr>
        <td>2</td><td>数据链路</td><td rowspan="2">网络接口</td>
    </tr>
    <tr>
        <td>1</td><td>物理</td>
    </tr>
</table>

思科现在更倾向于使用（新的）TCP 模型而不是 OSI 模型作为网络框架，但他们仍希望咱们掌握 OSI 模型。因此，他们直到现在仍将其保留在考试大纲中。

**表 1.5**  -- **新旧 TCP 模型对比**

| 旧的 TCP 模型 | 分层 | 新的 TCP 模型 |
| :-: | :-: | :-: |
|  | 5 | 应用 |
| 应用 | 4 | 传输/主机到主机 |
| 传输/主机到主机 | 3 | 网络 |
| 互联网 | 2 | 数据链路 |
| 链路/网络接口 | 1 | 链路/网络接口 |

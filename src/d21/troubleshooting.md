# VLAN 间路由的故障排除


VLAN 间路由问题，会以多种形式出现，尤其是考虑到该过程中涉及多个设备（交换机、路由器等）。通过遵循正确的故障排除方法，咱们就应能将问题隔离到某个特定设备，然后将其映射到某项错误配置的特定功能。

从连通性角度来看，需要检查的一些事项包括：

- 检查终端设备是否连接到正确的交换机端口
- 检查交换机端口到正确的路由器端口（在一台路由器用于 VLAN 间路由时）
+ 检查这个过程中涉及到的端口，是否承载着正确的 VLAN
    - 那些连接终端设备的端口，通常属于一些分配给特定 VLAN 的接入端口
    - 连接交换机到路由器的那些端口，通常属于中继端口


在确认设备之间的连通性正确无误后，下一合乎逻辑的步骤，便是排查二层的配置，以中继端口上所配置的封装方式开始，其通常是 802.1Q。接下来，要确保中继链路的两端，配置了同一封装方式。

可用于检查封装类型的一些命令如下：

- `show interface trunk`
- `show interface <number> switchport`

下面是个输出示例。

```console
Cat-3550-1#show interfaces trunk

Port        Mode        Encapsulation       Status      Native vlan
Fa0/1       on          802.1q              trunking    1
Fa0/2       on          802.1q              trunking    1

Port        Vlans allowed on trunk

Fa0/1       1,10,20,30,40,50
Fa0/2       1-99,201-4094
```

由 `show interface trunk` 命令提供的另一重要细节，是中继的状态。这点确认中继是否形成，以及是否需要链路两端加以检查。当接口未处于 `trunking` 模式下时，那么必须要检查的最重要事项之一，就是运行模式（`on`、`auto` 等），以确定其是否被允许，与链路另一端形成中继状态。


原生 VLAN 是有关中继端口咱们应检查的另一重要元素。错误配置的原生 VLAN，会导致功能缺失或安全问题。原生 VLAN 应在中继链路两端匹配。

若在验证了这些二层检查任务后，VLAN 间问题仍未解决，那么咱们可继续检查三层的配置。根据用于确保实际 VLAN 间路由的三层设备，三层配置的检查，可在以下设备之一上配置/验证：

- 多层交换机
- 路由器 -— 物理接口
- 路由器 -— 子接口


在三层设备上，咱们应检查是否为各个接口（或 SVI），分配了正确的子网，且在需要时，咱们还应检查路由协议。通常，每个 VLAN 都会分配不同子网，因此咱们应确保咱们没有错误配置接口。为了验证这点，咱们可针对特定物理接口、子接口或 SVL，使用 `show interface` 这条命令。



请参加 [Free CCNA Training Bonus – Cisco CCNA in 60 Days v4](https://www.in60days.com/free/ccnain60days/) 处今天的考试。

三层设备上应该检查一下其各接口（或者交换机虚拟接口，SVI）都有分配的正确的子网，同时如有必要，你还应检查一下路由协议。通常情况下，各个 VLAN 都有分配不同的子网，所以你应确保你未曾错误配置了接口。而为检查此项，你可以对特定物理接口、子接口或是 SVI，使用 `show interface` 命令。



#  NAT 基础知识

试想一下，网络运行于颜色上，而不是使用 IP 地址。蓝色和黄色的供应是无限的，但其他颜色却供不应求。咱们的网络分为许多使用蓝色和黄色的用户，因为他们可免费使用。蓝色的用户需要经常访问 web，因此咱们购买了少量绿色令牌，当蓝色用户需要访问 web 主机时，咱们的路由器便可用这些令牌，交换蓝色用户的令牌。咱们的路由器会这样做：


![内部凭据被替换成了外部凭据](../images/0601.png)

**图 30.1** -- **内部令牌交换为外部令牌**



| 内部令牌 | 外部令牌 |
| :- | :- |
| 蓝色 1 | 绿色 1  |
| 蓝色 2 | 绿色 2  |
| 蓝色 3 | 绿色 3  |


当每个蓝色设备结束外部连接后，绿色令牌就可以释放供另一蓝色设备使用。这样做的好处是，外部设备无法看到咱们的内部令牌 ID，同时咱们正帮助节省可用于互联网用途的有限数量绿色令牌。NAT 便运行于这一原理之上。


正如咱们能看到的，NAT 不仅保护了咱们网络 IP 地址的身份，也是另一种地址保存的方法。NAT 于路由器或防火墙上执行，因此，咱们看到的不是颜色，而是像下面这样的一些东西：


![内部地址被替换成外部地址](../images/0602.png)

**图 30.2** -- **内部地址交换为外部地址**


| 内部地址 | 外部地址 |
| -: | -: |
| 192.168.1.1 | 200.100.1.5 |
| 192.168.1.3 | 200.100.1.7 |

根据特定的需求，**在路由器上配置 NAT 有三种方式**。CCNA 考试要求你掌握所有三种方式。

为了配置  NAT ，要先告诉路由器，有哪些内部和外部接口。这是因为事实上可以将众多内部地址替换成某个 NAT 地址池中的地址（a pool of NAT  addresses ），或者最起码替换成单一的 NAT 地址, 并在路由器上的两个以太网接口之间完成 NAT 。

正如前面说的，对于考试和现实需求来说，通常都会将私有互联网地址转换成互联网上的可路由的地址（routable addresses on the  Internet ）。这在家庭宽带路由器上就能见到，其通常会给笔记本电脑一个`192.168.1`范围的 IP ，而在连接到 ISP 的接口上有着一个可路由的地址。

 NAT 令到私有网络上的主机可以访问互联网上的资源，或是可以访问到其它公共网络。 NAT 是一个 IETF 标准，其让局域网的内部流量使用一个 IP 地址集合，这些地址通常就是RFC  1918 中所定义的私有地址空间，对于外部流量，又使用另一个地址集合，这些地址通常是公开注册的 IP 地址空间。

 NAT 为进入和发出的流量去改装数据包的头部，并对每个会话进行跟踪。理解 NAT 的关键，同时也是 NAT 故障排除的关键，就是对 NAT 的有关术语有扎实理解。你应熟悉下面这些 NAT 名词。

-  NAT 内部接口
- 内部本地地址
- 内部全球地址
-  NAT 外部接口
- 外部本地地址
- 外部全球地址

上面 NAT 术语中的**内部接口，是指由该组织所控制的管理域的边界接口（the border interface of the administrative domain controlled by the  organization ）。而并不非得要是内部网络上的主机所使用的默认网关**。

而**内部本地地址则是某台内部网络上的主机的 IP 地址**。在**多数情况下，内部本地地址都是一个`RFC 1918`地址**（也就是不可路由地址，比如`192.168.x.x`或`172.16.x.x`等等）。该地址被转换成外部全局地址，那么**外部全局地址通常就是来自一个公开分配的或是经注册的地址池了**。要记住的是，尽管如此，**内部本地地址也可以是一个公网地址**。

**内部全局地址，则是内部主机在其呈现在外部世界时的地址**。一旦内部 IP 地址被转换过后，对公网或是其它任何外部网络及主机来说，它就成为了一个内部全局地址了。

与内部接口对应，**外部接口是指不受该组织所控制的管理域的边界**。换句话说，外部接口是连接外部网络的，连接的网络可以是互联网或其它任何的外部网络，比如友商网络等。任何处于外部接口外侧的主机，都不属于本地组织的管理之下。

**外部本地地址是某台外部主机呈现给内部主机的 IP 地址**。最后，**外部全局地址又是一个合法的、可在互联网上使用的公网地址**。外部本地地址和外部全局地址都是分配自一个全球可路由网络地址空间。

为搞清楚这些概念，图6. 3 表示了两台主机之间的一个会话中各种地址的使用。中间的网关上开启了 NAT 。

![理解 NAT 的各种内部外部地址](../images/0603.png)

*图6.3 -- 理解 NAT 的各种内部外部地址*

 NAT 内部和外部的分址，是一个经典的考试问题，所以还需在回头看几次这里的内容。


